(this["webpackJsonpsocial-app"]=this["webpackJsonpsocial-app"]||[]).push([[0],{25:function(e,t,n){e.exports=n.p+"static/media/trash.0eb3b1bc.svg"},26:function(e,t,n){e.exports=n(36)},36:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(15),c=n.n(o),u=n(2),i=n(13),s=n(4),l=n(11),h=n.n(l),m={token:null,isAuthenticated:null,user:null},p=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:m,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_USER":return Object(s.a)(Object(s.a)({},e),{},{token:t.token,isAuthenticated:!0,user:t.user});case"LOGIN_SUCCESS":case"REGISTER_SUCCESS":return h.a.set("token",t.token),Object(s.a)(Object(s.a)(Object(s.a)({},e),t.token),{},{token:t.token,isAuthenticated:!0,user:t.user});case"LOGIN_FAIL":case"REGISTER_FAIL":case"LOGOUT_SUCCESS":return h.a.remove("token"),Object(s.a)(Object(s.a)({},e),{},{token:null,user:null,isAuthenticated:!1});default:return e}},f={posts:[]},d=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f,t=arguments.length>1?arguments[1]:void 0;switch(t.type){case"LOAD_POST":return Object(s.a)(Object(s.a)({},e),{},{posts:e.posts.concat(t.posts)});case"NEW_POST":return Object(s.a)(Object(s.a)({},e),{},{posts:e.posts.concat(t.newPost)});case"EDIT_POST":return Object(s.a)(Object(s.a)({},e),{},{posts:e.posts.map((function(e){return e.id===t.editedPost.id?t.editedPost:e}))});case"DELETE_POST":return Object(s.a)(Object(s.a)({},e),{},{posts:e.posts.filter((function(e){return e.id!==t.toDeletePost.id}))});default:return e}},E=Object(i.b)({auth:p,posts:d}),b=Object(i.c)(E,window.__REDUX_DEVTOOLS_EXTENSION__&&window.__REDUX_DEVTOOLS_EXTENSION__()),O=n(21),j=n(3),g=n(9),k=n(6),y=function(e){return{type:"EDIT_POST",editedPost:e}},S=n(25),v=n.n(S),w=function(){var e=Object(u.c)((function(e){return e.auth.isAuthenticated})),t=Object(u.c)((function(e){return e.auth.user})),n=Object(u.c)((function(e){return e.auth.token})),o=Object(u.c)((function(e){return e.posts.posts})),c=Object(a.useState)(""),i=Object(k.a)(c,2),s=i[0],l=i[1],h=Object(a.useState)(""),m=Object(k.a)(h,2),p=m[0],f=m[1],d=Object(a.useState)(""),E=Object(k.a)(d,2),b=E[0],O=E[1],j=Object(u.b)();Object(a.useEffect)((function(){0===o.length&&fetch("https://api-minireseausocial.mathis-dyk.fr/posts").then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){j(function(e){return{type:"LOAD_POST",posts:e}}(e))}))}),[o,j]);return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Welcome on My Social Network."),r.a.createElement("p",null,"This website is a training to Redux and React. We use auth and routing to create a small social media website."),e&&r.a.createElement(r.a.Fragment,null,r.a.createElement("h2",null,"Hello ",t.username,", what do you want to share with us today ?"),r.a.createElement("input",{type:"text",placeholder:"your shitty message",onChange:function(e){return l(e.target.value)},value:s}),r.a.createElement("button",{onClick:function(){var e={text:s,user:t.id};fetch("https://api-minireseausocial.mathis-dyk.fr/posts",{method:"post",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(e)}).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){j({type:"NEW_POST",newPost:e}),l("")})).catch((function(e){alert(e)}))}},"Add your post")),r.a.createElement("div",null,r.a.createElement("ul",null,o.sort((function(e,t){return new Date(t.created_at)-new Date(e.created_at)})).map((function(a){return!(!a.text||!a.user)&&r.a.createElement("li",{key:a.id},e&&a.user.id===t.id&&b!==a.id&&r.a.createElement(r.a.Fragment,null,r.a.createElement("img",{src:v.a,alt:"delete post",onClick:function(){return e=a,void(window.confirm("Le message va \xeatre supprim\xe9")&&fetch("https://api-minireseausocial.mathis-dyk.fr/posts/".concat(e.id),{method:"delete",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)}}).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){j({type:"DELETE_POST",toDeletePost:e})})).catch((function(e){alert(e)})));var e},style:{height:"1em"}}),r.a.createElement("button",{onClick:function(){return O(a.id)}},"Edit")),e&&r.a.createElement(g.b,{to:"/user/".concat(a.user.id)},r.a.createElement("b",null,a.user.username," : ")),b!==a.id&&r.a.createElement(r.a.Fragment,null,a.text),e&&b!==a.id&&r.a.createElement("span",{onClick:function(){return function(e){var t={like:e.like+1};fetch("https://api-minireseausocial.mathis-dyk.fr/posts/".concat(e.id),{method:"put",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(t)}).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){j(y(e)),O("")})).catch((function(e){alert(e)}))}(a)}}," ",r.a.createElement("b",null,"|")," ","\u2764 ".concat(a.like?a.like:0)," ",r.a.createElement("b",null,"|")),b===a.id&&r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{value:p,onFocus:function(){return f(a.text)},autoFocus:!0,onChange:function(e){return f(e.target.value)}}),r.a.createElement("button",{onClick:function(){return function(e){var t={text:p};fetch("https://api-minireseausocial.mathis-dyk.fr/posts/".concat(e.id),{method:"put",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(n)},body:JSON.stringify(t)}).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){j(y(e)),O("")})).catch((function(e){alert(e)}))}(a)}},"edit post"),r.a.createElement("button",{onClick:function(){return O("")}},"cancel")))})))))},T=function(){var e=Object(u.c)((function(e){return e.auth.isAuthenticated})),t=Object(a.useState)(""),n=Object(k.a)(t,2),o=n[0],c=n[1],i=Object(a.useState)(""),s=Object(k.a)(i,2),l=s[0],h=s[1],m=Object(u.b)(),p=Object(j.g)();Object(a.useEffect)((function(){e&&p.push("/")}),[e,p]);return r.a.createElement("div",null,!e&&r.a.createElement(r.a.Fragment,null,r.a.createElement("input",{type:"text",placeholder:"email",value:o,onChange:function(e){return c(e.target.value)},required:!0}),r.a.createElement("input",{type:"password",placeholder:"password",value:l,onChange:function(e){return h(e.target.value)},required:!0}),r.a.createElement("button",{onClick:function(){var e={identifier:o,password:l};fetch("https://api-minireseausocial.mathis-dyk.fr/auth/local/",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){m(function(e){return{type:"LOGIN_SUCCESS",token:e.jwt,user:e.user}}(e)),p.push("/")})).catch((function(e){m({type:"LOGIN_FAIL"}),alert(e)}))}},"Submit")),e&&r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"connexion r\xe9ussi !")))},C=function(){var e=Object(u.c)((function(e){return e.auth.isAuthenticated})),t=Object(u.b)(),n=Object(j.g)();return r.a.createElement(r.a.Fragment,null,r.a.createElement(g.b,{to:"/"}," Home "),!e&&r.a.createElement(r.a.Fragment,null,r.a.createElement(g.b,{to:"/login"}," Login "),r.a.createElement(g.b,{to:"/register"}," Register ")),e&&r.a.createElement(r.a.Fragment,null,r.a.createElement(g.b,{to:"/profile"}," Profile "),r.a.createElement("button",{onClick:function(){t({type:"LOGOUT_SUCCESS"}),n.push("/")}},"Se d\xe9connecter")))},_=function(){var e=Object(a.useState)(""),t=Object(k.a)(e,2),n=t[0],o=t[1],c=Object(a.useState)(""),i=Object(k.a)(c,2),s=i[0],l=i[1],h=Object(a.useState)(""),m=Object(k.a)(h,2),p=m[0],f=m[1],d=Object(u.b)(),E=Object(j.g)();return r.a.createElement("div",null,r.a.createElement("input",{type:"text",placeholder:"username",value:n,onChange:function(e){return o(e.target.value)},required:!0}),r.a.createElement("input",{type:"text",placeholder:"email",value:s,onChange:function(e){return l(e.target.value)},required:!0}),r.a.createElement("input",{type:"password",placeholder:"password",value:p,onChange:function(e){return f(e.target.value)},required:!0}),r.a.createElement("button",{onClick:function(){var e={username:n,email:s,password:p};fetch("https://api-minireseausocial.mathis-dyk.fr/auth/local/register",{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){d(function(e){return{type:"REGISTER_SUCCESS",token:e.jwt,user:e.user}}(e)),E.push("/")})).catch((function(e){d({type:"REGISTER_FAIL"}),alert(e)}))}},"Submit"))},x=function(){var e=Object(u.c)((function(e){return e.auth.user})),t=Object(u.c)((function(e){return e.auth.token})),n=Object(u.c)((function(e){return e.posts.posts})),a=e.id,o=e.username;return r.a.createElement(r.a.Fragment,null,r.a.createElement("h1",null,"Welcome on your profile."),r.a.createElement("p",null,"id : ",a),r.a.createElement("p",null,"name : ",o),r.a.createElement("button",{onClick:function(){n.forEach((function(e){if(!e.like){var n={like:Math.floor(Math.random()*Math.floor(1e3))};fetch("https://api-minireseausocial.mathis-dyk.fr/posts/".concat(e.id),{method:"put",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(t)},body:JSON.stringify(n)}).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){console.log(e)})).catch((function(e){alert(e)}))}}))}},"like for all"))},A=function(){var e=Object(u.c)((function(e){return e.auth.token})),t=Object(a.useState)({}),n=Object(k.a)(t,2),o=n[0],c=n[1],i=Object(a.useState)([]),s=Object(k.a)(i,2),l=s[0],h=s[1],m=Object(j.h)().userId;return Object(a.useEffect)((function(){fetch("https://api-minireseausocial.mathis-dyk.fr/users/".concat(m),{method:"get",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){c(e)})).catch((function(e){alert(e)})),fetch("https://api-minireseausocial.mathis-dyk.fr/posts?user.id=".concat(m),{method:"get",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e)}}).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){h(e)})).catch((function(e){alert(e)}))}),[e,m]),r.a.createElement(r.a.Fragment,null,r.a.createElement("div",null,r.a.createElement("h1",null,"Welcome on ",o.username,"'s profile."),r.a.createElement("p",null,"id : ",o.id),r.a.createElement("p",null,"name : ",o.username),r.a.createElement("p",null,"description : ",o.description)),r.a.createElement("h2",null,"Les messages post\xe9s par ",o.username),r.a.createElement("ul",null,l.sort((function(e,t){return new Date(t.created_at)-new Date(e.created_at)})).map((function(e){return!(!e.text||!e.user)&&r.a.createElement("li",{key:e.id},r.a.createElement("b",null,e.user.username," : "),e.text,r.a.createElement("span",{onClick:function(){return console.log("like")}}," ",r.a.createElement("b",null,"|")," ","\u2764 ".concat(e.like?e.like:0)," ",r.a.createElement("b",null,"|")))}))))},L=function(){var e=Object(u.c)((function(e){return e.auth.isAuthenticated})),t=Object(u.b)();Object(a.useEffect)((function(){h.a.get("token")&&fetch("https://api-minireseausocial.mathis-dyk.fr/users/me",{method:"get",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(h.a.get("token"))}}).then((function(e){if(!e.ok)throw Error(e.statusText);return e})).then((function(e){return e.json()})).then((function(e){t(function(e){return{type:"LOAD_USER",user:e,token:h.a.get("token")}}(e))})).catch((function(e){console.log(e)}))}),[t]);var n=function(t){var n=t.component,a=Object(O.a)(t,["component"]);return r.a.createElement(j.b,Object.assign({},a,{render:function(t){return e?r.a.createElement(j.a,{to:{pathname:"/"}}):r.a.createElement(n,t)}}))},o=function(t){var n=t.component,a=Object(O.a)(t,["component"]);return r.a.createElement(j.b,Object.assign({},a,{render:function(t){return e?r.a.createElement(n,t):r.a.createElement(j.a,{to:{pathname:"/login"}})}}))};return r.a.createElement(g.a,{basename:"/NextSocialApp"},r.a.createElement(C,null),r.a.createElement(j.d,null,r.a.createElement(n,{path:"/login",component:T}),r.a.createElement(n,{path:"/register",component:_}),r.a.createElement(o,{path:"/profile",component:x}),r.a.createElement(o,{path:"/user/:userId",component:A}),r.a.createElement(j.b,{exact:!0,path:"/",component:w})))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));c.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(u.a,{store:b},r.a.createElement(L,null))),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[26,1,2]]]);
//# sourceMappingURL=main.afdf33a0.chunk.js.map